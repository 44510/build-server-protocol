<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>bsp</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
div.sourceLine, a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
div.sourceLine, a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource div.sourceLine, .numberSource a.sourceLine
  { position: relative; }
pre.numberSource div.sourceLine::before, .numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em; }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; color: #aaaaaa;  padding-left: 4px; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.bn { color: #40a070; } /* BaseN */
code span.fl { color: #40a070; } /* Float */
code span.ch { color: #4070a0; } /* Char */
code span.st { color: #4070a0; } /* String */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.ot { color: #007020; } /* Other */
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.fu { color: #06287e; } /* Function */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #880000; } /* Constant */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.ss { color: #bb6688; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #19177c; } /* Variable */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.op { color: #666666; } /* Operator */
code span.bu { } /* BuiltIn */
code span.ex { } /* Extension */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.at { color: #7d9029; } /* Attribute */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="pandoc.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="1-build-server-protocol">1. Build Server Protocol</h1>
<p>This document is a draft version of the Build Server Protocol (BSP), written by Ólafur Páll Geirsson, Jorge Vicente Cantero with feedback from Guillaume Martres and Eugene Burmako. The Build Server Protocol takes inspiration from the Language Server Protocol (LSP). Unlike in the Language Server Protocol, the language server is referred to as the “client” and a build tool such as sbt/pants/gradle/bazel is referred to as the “server”.</p>
<p>The best way to read this document is by considering it as a wishlist from the perspective of a language server developer. A proof-of-concept integration between scalameta/language-server and scalacenter/bloop using the Build Server Protocol is in the works. Everything in this document is subject to change and open for discussions. Including core data structures. Consider this document as our personal vision for how a bi-directional communication protocol between a build tool and language server should look like.</p>
<p>The code listings in this document are written using Scala syntax. Every data strucuture in this document has a direct translation to JSON and Protocol Buffers. See <a href="#15-appendix">Appendix</a> for schema definitions that can be used to automatically generate bindings for different target languages.</p>
<!-- TOC -->

<ul>
<li><a href="#1-build-server-protocol">1. Build Server Protocol</a>
<ul>
<li><a href="#11-base-protocol">1.1. Base protocol</a></li>
<li><a href="#12-basic-json-structures">1.2. Basic Json Structures</a>
<ul>
<li><a href="#121-build-target">1.2.1. Build Target</a></li>
<li><a href="#122-build-target-identifier">1.2.2. Build Target Identifier</a></li>
</ul></li>
<li><a href="#13-actual-protocol">1.3. Actual Protocol</a>
<ul>
<li><a href="#131-server-lifetime">1.3.1. Server Lifetime</a>
<ul>
<li><a href="#1311-initialize-build-request">1.3.1.1. Initialize Build Request</a></li>
<li><a href="#1312-initialized-build-notification">1.3.1.2. Initialized Build Notification</a></li>
<li><a href="#1313-shutdown-build-request">1.3.1.3. Shutdown Build Request</a></li>
<li><a href="#1314-exit-build-notification">1.3.1.4. Exit Build Notification</a></li>
</ul></li>
<li><a href="#132-workspace-build-targets-request">1.3.2. Workspace Build Targets Request</a></li>
<li><a href="#133-build-target-changed-notification">1.3.3. Build Target Changed Notification</a></li>
<li><a href="#134-build-target-text-documents-request">1.3.4. Build Target Text Documents Request</a></li>
<li><a href="#135-text-document-build-targets-request">1.3.5. Text Document Build Targets Request</a></li>
<li><a href="#136-dependency-sources-request">1.3.6. Dependency Sources Request</a></li>
<li><a href="#137-compile-request">1.3.7. Compile Request</a></li>
<li><a href="#138-test-request">1.3.8. Test Request</a></li>
</ul></li>
<li><a href="#14-extensions">1.4. Extensions</a>
<ul>
<li><a href="#141-scala">1.4.1. Scala</a>
<ul>
<li><a href="#1411-scala-build-target">1.4.1.1. Scala Build Target</a></li>
<li><a href="#1412-scalac-options-request">1.4.1.2. Scalac Options Request</a></li>
<li><a href="#1413-scala-test-classes-request">1.4.1.3. Scala Test Classes Request</a></li>
</ul></li>
</ul></li>
<li><a href="#15-appendix">1.5. Appendix</a>
<ul>
<li><a href="#151-protobuf-schema-definitions">1.5.1. Protobuf schema definitions</a></li>
<li><a href="#152-scala-bindings">1.5.2. Scala Bindings</a></li>
</ul></li>
</ul></li>
</ul>
<!-- /TOC -->

<h2 id="11-base-protocol">1.1. Base protocol</h2>
<p>The base protocol is identical to the language server base protocol. See <a href="https://microsoft.github.io/language-server-protocol/specification" class="uri">https://microsoft.github.io/language-server-protocol/specification</a> for more details.</p>
<p>Like the language server protocol, the build server protocol defines a set of JSON-RPC request, response and notification messages which are exchanged using the base protocol.</p>
<h2 id="12-basic-json-structures">1.2. Basic Json Structures</h2>
<p>In addition to basic data structures in the language server protocol, the build server protocol defines the following additional data structures.</p>
<h3 id="121-build-target">1.2.1. Build Target</h3>
<p>Build target contains metadata about an artifact (for example library, test, or binary artifact). Using vocabulary of other build tools:</p>
<ul>
<li>sbt: a build target is a combined project + config. Example:
<ul>
<li>a regular JVM project with main and test configurations will have two build targets, one for main and one for test.</li>
<li>a single configuration in a single project that contains both Java and Scala sources maps to one BuildTarget.</li>
<li>a project with crossScalaVersions 2.11 and 2.12 containing main and test configuration in each will have four build targets.</li>
<li>a Scala 2.11 and 2.12 cross-built project for Scala.js and the JVM with main and test configurations will have six build targets.</li>
</ul></li>
<li>pants: a pants target corresponds one-to-one with a BuildTarget</li>
<li>bazel: a bazel target corresponds one-to-one with a BuildTarget</li>
</ul>
<p>The general idea is that the BuildTarget data structure should contain only information that is is fast or cheap to compute.</p>
<pre class="sourceCode scala" id="cb1"><code class="sourceCode scala"><div class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">trait</span> BuildTarget {</div>
<div class="sourceLine" id="cb1-2" data-line-number="2"></div>
<div class="sourceLine" id="cb1-3" data-line-number="3">  <span class="co">/**</span> The target’s unique identifier <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-4" data-line-number="4">  <span class="kw">def</span> id: BuildTargetIdentifier</div>
<div class="sourceLine" id="cb1-5" data-line-number="5"></div>
<div class="sourceLine" id="cb1-6" data-line-number="6">  <span class="co">/**</span> A human readable name for this target<span class="co">.</span></div>
<div class="sourceLine" id="cb1-7" data-line-number="7">    <span class="co">*</span> May be presented in the user interface<span class="co">.</span></div>
<div class="sourceLine" id="cb1-8" data-line-number="8">    <span class="co">*</span> Should be unique if possible<span class="co">.</span></div>
<div class="sourceLine" id="cb1-9" data-line-number="9">    <span class="co">*</span> The id<span class="co">.</span>uri is used if None<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-10" data-line-number="10">  <span class="kw">def</span> displayName: Option[String]</div>
<div class="sourceLine" id="cb1-11" data-line-number="11"></div>
<div class="sourceLine" id="cb1-12" data-line-number="12">  <span class="co">/**</span> The category of this build target<span class="co">. */</span></div>
<div class="sourceLine" id="cb1-13" data-line-number="13">  <span class="kw">def</span> kind: List[BuildTargetKind]</div>
<div class="sourceLine" id="cb1-14" data-line-number="14"></div>
<div class="sourceLine" id="cb1-15" data-line-number="15">  <span class="co">/**</span> The set of languages that this target contains<span class="co">.</span></div>
<div class="sourceLine" id="cb1-16" data-line-number="16">    <span class="co">*</span> The ID string for each language is defined in the LSP<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-17" data-line-number="17">  <span class="kw">def</span> languageIds: List[String]</div>
<div class="sourceLine" id="cb1-18" data-line-number="18"></div>
<div class="sourceLine" id="cb1-19" data-line-number="19">  <span class="co">/**</span> Language<span class="co">-</span>specific metadata about this target<span class="co">.</span></div>
<div class="sourceLine" id="cb1-20" data-line-number="20">    <span class="co">*</span> See ScalaBuildTarget as an example<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-21" data-line-number="21">  <span class="kw">def</span> data: Option[Json] <span class="co">// Note, matches `any` in the LSP.</span></div>
<div class="sourceLine" id="cb1-22" data-line-number="22">}</div>
<div class="sourceLine" id="cb1-23" data-line-number="23"></div>
<div class="sourceLine" id="cb1-24" data-line-number="24"><span class="kw">object</span> BuildTargetKind {</div>
<div class="sourceLine" id="cb1-25" data-line-number="25">  <span class="kw">val</span> Library = <span class="dv">1</span></div>
<div class="sourceLine" id="cb1-26" data-line-number="26">  <span class="co">/**</span> This target can be compiled and tested via</div>
<div class="sourceLine" id="cb1-27" data-line-number="27">    <span class="co">*</span> method buildTarget<span class="co">/</span>test <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-28" data-line-number="28">  <span class="kw">val</span> Test = <span class="dv">2</span></div>
<div class="sourceLine" id="cb1-29" data-line-number="29">  <span class="co">/**</span> This target can be tested via method</div>
<div class="sourceLine" id="cb1-30" data-line-number="30">    <span class="co">*</span> buildTarget<span class="co">/</span>test and may run slower compared to a Test<span class="co">. */</span></div>
<div class="sourceLine" id="cb1-31" data-line-number="31">  <span class="kw">val</span> IntegrationTest = <span class="dv">3</span></div>
<div class="sourceLine" id="cb1-32" data-line-number="32">  <span class="co">/**</span> This target can be run via method buildTarget<span class="co">/</span>run <span class="co">*/</span></div>
<div class="sourceLine" id="cb1-33" data-line-number="33">  <span class="kw">val</span> Main = <span class="dv">4</span></div>
<div class="sourceLine" id="cb1-34" data-line-number="34">}</div></code></pre>
<h3 id="122-build-target-identifier">1.2.2. Build Target Identifier</h3>
<p>A unique identifier for a target.</p>
<pre class="sourceCode scala" id="cb2"><code class="sourceCode scala"><div class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">trait</span> BuildTargetIdentifer {</div>
<div class="sourceLine" id="cb2-2" data-line-number="2">  <span class="co">/**</span> The target’s URI <span class="co">*/</span></div>
<div class="sourceLine" id="cb2-3" data-line-number="3">  <span class="kw">def</span> uri: URI</div>
<div class="sourceLine" id="cb2-4" data-line-number="4">}</div></code></pre>
<h2 id="13-actual-protocol">1.3. Actual Protocol</h2>
<p>Unlike the language server protocol, the build server protocol does not support dynamic registration of capabilities. The motivation for this change is simplicity. If a motivating example for dynamic registration comes up this decision can be reconsidered. The server and client capabilities must be communicated through the initialize request.</p>
<h3 id="131-server-lifetime">1.3.1. Server Lifetime</h3>
<p>Like the language server protocol, the current protocol specification defines that the lifetime of a build server is managed by the client (e.g. a language server like Dotty IDE). It is up to the client to decide when to start (process-wise) and when to shutdown a server.</p>
<h4 id="1311-initialize-build-request">1.3.1.1. Initialize Build Request</h4>
<p>Like the language server protocol, the initialize request is sent as the first request from the client to the server. If the server receives a request or notification before the initialize request it should act as follows:</p>
<ul>
<li><p>For a request the response should be an error with code: -32002. The message can be picked by the server.</p></li>
<li><p>Notifications should be dropped, except for the exit notification. This will allow the exit of a server without an initialize request.</p></li>
</ul>
<p>Until the server has responded to the initialize request with an InitializeBuildResult, the client must not send any additional requests or notifications to the server.</p>
<p>Request:</p>
<ul>
<li><p>method: ‘build/initialize’</p></li>
<li><p>params: InitializeBuildParams defined as follows</p></li>
</ul>
<pre class="sourceCode scala" id="cb3"><code class="sourceCode scala"><div class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">trait</span> InitializeBuildParams {</div>
<div class="sourceLine" id="cb3-2" data-line-number="2"></div>
<div class="sourceLine" id="cb3-3" data-line-number="3">  <span class="co">/**</span> The rootUri of the workspace <span class="co">*/</span></div>
<div class="sourceLine" id="cb3-4" data-line-number="4">  <span class="kw">def</span> rootUri: DocumentUri</div>
<div class="sourceLine" id="cb3-5" data-line-number="5"></div>
<div class="sourceLine" id="cb3-6" data-line-number="6">  <span class="co">/**</span> The capabilities of the client <span class="co">*/</span></div>
<div class="sourceLine" id="cb3-7" data-line-number="7">  <span class="kw">def</span> capabilities: BuildClientCapabilities</div>
<div class="sourceLine" id="cb3-8" data-line-number="8"></div>
<div class="sourceLine" id="cb3-9" data-line-number="9">}</div>
<div class="sourceLine" id="cb3-10" data-line-number="10"></div>
<div class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw">trait</span> BuildClientCapabilities {</div>
<div class="sourceLine" id="cb3-12" data-line-number="12">    <span class="co">/**</span> The languages that this client supports<span class="co">.</span></div>
<div class="sourceLine" id="cb3-13" data-line-number="13">      <span class="co">*</span> The ID strings for each language is defined in the LSP<span class="co">.</span></div>
<div class="sourceLine" id="cb3-14" data-line-number="14">      <span class="co">*</span> The server must never respond with build targets for other</div>
<div class="sourceLine" id="cb3-15" data-line-number="15">      <span class="co">*</span> languages than those that appear in this list<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb3-16" data-line-number="16">    <span class="kw">def</span> languageIds: List[String]</div>
<div class="sourceLine" id="cb3-17" data-line-number="17">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: InitializeBuildResult defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb4"><code class="sourceCode scala"><div class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">trait</span> InitializeBuildResult {</div>
<div class="sourceLine" id="cb4-2" data-line-number="2">  <span class="co">/**</span> The capabilities of the build server <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-3" data-line-number="3">  capabilities: BuildServerCapabilities</div>
<div class="sourceLine" id="cb4-4" data-line-number="4">}</div>
<div class="sourceLine" id="cb4-5" data-line-number="5"></div>
<div class="sourceLine" id="cb4-6" data-line-number="6"><span class="kw">trait</span> BuildServerCapabilities {</div>
<div class="sourceLine" id="cb4-7" data-line-number="7">  <span class="co">/**</span> The server can compile targets via method buildTarget<span class="co">/</span>compile <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-8" data-line-number="8">  compileProvider: Boolean</div>
<div class="sourceLine" id="cb4-9" data-line-number="9">  <span class="co">/**</span> The server can test targets via method buildTarget<span class="co">/</span>test <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-10" data-line-number="10">  testProvider: Boolean</div>
<div class="sourceLine" id="cb4-11" data-line-number="11">  <span class="co">/**</span> The server can provide a list of targets that contain a</div>
<div class="sourceLine" id="cb4-12" data-line-number="12">    <span class="co">*</span> single text document via the method textDocument<span class="co">/</span>buildTargets <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-13" data-line-number="13">  textDocumentBuildTargetsProvider: Boolean</div>
<div class="sourceLine" id="cb4-14" data-line-number="14">  <span class="co">/**</span> The server provides sources for library dependencies</div>
<div class="sourceLine" id="cb4-15" data-line-number="15">    <span class="co">*</span> via method buildTarget<span class="co">/</span>dependencySources <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-16" data-line-number="16">  dependencySourcesProvider: Boolean</div>
<div class="sourceLine" id="cb4-17" data-line-number="17">  <span class="co">/**</span> The server sends notifications to the client on build</div>
<div class="sourceLine" id="cb4-18" data-line-number="18">    <span class="co">*</span> target change events via buildTarget<span class="co">/</span>didChange <span class="co">*/</span></div>
<div class="sourceLine" id="cb4-19" data-line-number="19">  buildTargetChangedProvider: Boolean</div>
<div class="sourceLine" id="cb4-20" data-line-number="20">}</div></code></pre>
<h4 id="1312-initialized-build-notification">1.3.1.2. Initialized Build Notification</h4>
<p>Like the language server protocol, the initialized notification is sent from the client to the server after the client received the result of the initialize request but before the client is sending any other request or notification to the server. The server can use the initialized notification for example to initialize intensive computation such as dependency resolution or compilation. The initialized notification may only be sent once.</p>
<p>Notification:</p>
<ul>
<li>method: ‘build/initialized’</li>
<li>params: InitializedBuildParams defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb5"><code class="sourceCode scala"><div class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">trait</span> InitializedBuildParams {</div>
<div class="sourceLine" id="cb5-2" data-line-number="2"></div>
<div class="sourceLine" id="cb5-3" data-line-number="3">}</div></code></pre>
<h4 id="1313-shutdown-build-request">1.3.1.3. Shutdown Build Request</h4>
<p>Like the language server protocol, the shutdown build request is sent from the client to the server. It asks the server to shut down, but to not exit (otherwise the response might not be delivered correctly to the client). There is a separate exit notification that asks the server to exit.</p>
<p>Request:</p>
<ul>
<li>method: ‘shutdown’</li>
<li>params: <code>null</code></li>
</ul>
<p>Response:</p>
<ul>
<li>result: <code>null</code></li>
<li>error: code and message set in case an exception happens during shutdown request.</li>
</ul>
<h4 id="1314-exit-build-notification">1.3.1.4. Exit Build Notification</h4>
<p>Like the language server protocol, a notification to ask the server to exit its process. The server should exit with success code 0 if the shutdown request has been received before; otherwise with error code 1.</p>
<p>Notification:</p>
<ul>
<li>method: ‘exit’</li>
<li>params: <code>null</code></li>
</ul>
<h3 id="132-workspace-build-targets-request">1.3.2. Workspace Build Targets Request</h3>
<p>The workspace build targets request is sent from the client to the server to ask for the list of all available build targets in the workspace.</p>
<p>Request:</p>
<ul>
<li>method: 'workspace/buildTargets'</li>
<li>params: <code>WorkspaceBuildTargetsParams</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb6"><code class="sourceCode scala"><div class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">trait</span> WorkspaceBuildTargetsParams {</div>
<div class="sourceLine" id="cb6-2" data-line-number="2">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>WorkspaceBuildTargetsResult</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb7"><code class="sourceCode scala"><div class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">trait</span> WorkspaceBuildTargetsResult {</div>
<div class="sourceLine" id="cb7-2" data-line-number="2">  <span class="co">/**</span> The build targets in this workspace that</div>
<div class="sourceLine" id="cb7-3" data-line-number="3">    <span class="co">*</span> contain sources with the given language ids<span class="co">. */</span></div>
<div class="sourceLine" id="cb7-4" data-line-number="4">  <span class="kw">def</span> targets: List[BuildTarget]</div>
<div class="sourceLine" id="cb7-5" data-line-number="5">}</div></code></pre>
<h3 id="133-build-target-changed-notification">1.3.3. Build Target Changed Notification</h3>
<p>The build target changed notification is sent from the server to the client to signal a change in a build target. The server communicates during the initialize handshake whether this method is supported or not.</p>
<p>Notification:</p>
<ul>
<li>method: 'buildTarget/didChange'</li>
<li>params: <code>DidChangeBuildTarget</code> defined as follows:</li>
</ul>
<pre class="sourceCode scala" id="cb8"><code class="sourceCode scala"><div class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">trait</span> DidChangeBuildTarget {</div>
<div class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw">def</span> changes: List[BuildTargetEvent]</div>
<div class="sourceLine" id="cb8-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">trait</span> BuildTargetEvent {</div>
<div class="sourceLine" id="cb8-5" data-line-number="5">  <span class="co">/**</span> The identifier for the changed build target <span class="co">*/</span></div>
<div class="sourceLine" id="cb8-6" data-line-number="6">  <span class="kw">def</span> uri: URI</div>
<div class="sourceLine" id="cb8-7" data-line-number="7">  <span class="co">/**</span> The kind of change for this build target <span class="co">*/</span></div>
<div class="sourceLine" id="cb8-8" data-line-number="8">  <span class="kw">def</span> kind: Option[BuildTargetEventKind]</div>
<div class="sourceLine" id="cb8-9" data-line-number="9"></div>
<div class="sourceLine" id="cb8-10" data-line-number="10">  <span class="co">/**</span> Any additional metadata about what information changed<span class="co">. */</span></div>
<div class="sourceLine" id="cb8-11" data-line-number="11">  <span class="kw">def</span> data: Option[Json]</div>
<div class="sourceLine" id="cb8-12" data-line-number="12">}</div>
<div class="sourceLine" id="cb8-13" data-line-number="13"><span class="kw">object</span> BuildTargetEventKind {</div>
<div class="sourceLine" id="cb8-14" data-line-number="14">  <span class="kw">val</span> Created = <span class="dv">1</span></div>
<div class="sourceLine" id="cb8-15" data-line-number="15">  <span class="kw">val</span> Changed = <span class="dv">2</span></div>
<div class="sourceLine" id="cb8-16" data-line-number="16">  <span class="kw">val</span> Deleted = <span class="dv">3</span></div>
<div class="sourceLine" id="cb8-17" data-line-number="17">}</div></code></pre>
<h3 id="134-build-target-text-documents-request">1.3.4. Build Target Text Documents Request</h3>
<p>The build target text documents request is sent from the client to the server to query for the list of source files that are part of a given list of build targets.</p>
<ul>
<li>method: <code>buildTarget/textDocuments</code></li>
<li>params: <code>BuildTargetTextDocumentsParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb9"><code class="sourceCode scala"><div class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">trait</span> BuildTargetTextDocumentsParams {</div>
<div class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb9-3" data-line-number="3">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>BuildTargetTextDocumentsResponse</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb10"><code class="sourceCode scala"><div class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">trait</span> BuildTargetTextDocumentsResponse {</div>
<div class="sourceLine" id="cb10-2" data-line-number="2">  <span class="co">/**</span> The source files used by this target <span class="co">*/</span></div>
<div class="sourceLine" id="cb10-3" data-line-number="3">  <span class="kw">def</span> textDocuments: List[TextDocumentIdentifier]</div>
<div class="sourceLine" id="cb10-4" data-line-number="4">}</div></code></pre>
<h3 id="135-text-document-build-targets-request">1.3.5. Text Document Build Targets Request</h3>
<p>The text document build targets request is sent from the client to the server to query for the list of targets containing the given text document. The server communicates during the initialize handshake whether this method is supported or not.</p>
<p>This request may be considered as the inverse of <code>buildTarget/textDocuments</code>. This method can be used by a language server on <code>textDocument/didOpen</code> to lookup which compiler instance to use to compile that given text document. In the case there are multiple targets (for example different platforms: JVM/JS, or x86/ARM) containing the same source file, the language server may present in the editor multiple options via <code>textDocument/codeLens</code> to configure how to dis-ambiguate.</p>
<ul>
<li>method: <code>textDocument/buildTargets</code></li>
<li>params: <code>TextDocumentBuildTargetsParams</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb11"><code class="sourceCode scala"><div class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">trait</span> TextDocumentBuildTargetsParams {</div>
<div class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw">def</span> textDocument: TextDocumentIdentifier</div>
<div class="sourceLine" id="cb11-3" data-line-number="3">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>TextDocumentBuildTargetsResult</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb12"><code class="sourceCode scala"><div class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">trait</span> TextDocumentBuildTargetsResult {</div>
<div class="sourceLine" id="cb12-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb12-3" data-line-number="3">}</div></code></pre>
<h3 id="136-dependency-sources-request">1.3.6. Dependency Sources Request</h3>
<p>The build target dependency sources request is sent from the client to the server to query for the list of sources for the dependency classpath of a given list of build targets. The server communicates during the initialize handshake whether this method is supported or not. This method can be used by a language server on <code>textDocument/definition</code> to &quot;Go to definition&quot; from project sources to dependency sources.</p>
<ul>
<li>method: <code>buildTarget/dependencySources</code></li>
<li>params: <code>DependencySourcesParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb13"><code class="sourceCode scala"><div class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">trait</span> DependencySourcesParams {</div>
<div class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb13-3" data-line-number="3">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>DependencySourcesResult</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb14"><code class="sourceCode scala"><div class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">trait</span> DependencySourcesResult {</div>
<div class="sourceLine" id="cb14-2" data-line-number="2">  <span class="kw">def</span> items: List[DependencySourcesItem]</div>
<div class="sourceLine" id="cb14-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">trait</span> DependencySourcesItem {</div>
<div class="sourceLine" id="cb14-5" data-line-number="5">  <span class="kw">def</span> target: BuildTargetIdentifier</div>
<div class="sourceLine" id="cb14-6" data-line-number="6">  <span class="co">/**</span> List of resources containing source files of the</div>
<div class="sourceLine" id="cb14-7" data-line-number="7">    <span class="co">*</span> target<span class="co">&#39;</span>s dependencies<span class="co">.</span></div>
<div class="sourceLine" id="cb14-8" data-line-number="8">    <span class="co">*</span> Can be jar files<span class="co">,</span> zip files<span class="co">,</span> or directories<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb14-9" data-line-number="9">  <span class="kw">def</span> sources: List[URI]</div>
<div class="sourceLine" id="cb14-10" data-line-number="10">}</div></code></pre>
<h3 id="137-compile-request">1.3.7. Compile Request</h3>
<p>The compile build target request is sent from the client to the server to compile the given list of build targets. The server communicates during the initialize handshake whether this method is supported or not. This method can for example be used by a language server before <code>textDocument/rename</code> to ensure that all workspace sources typecheck correctly and are up-to-date.</p>
<ul>
<li>method: <code>buildTarget/compile</code></li>
<li>params: <code>CompileParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb15"><code class="sourceCode scala"><div class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">trait</span> CompileParams {</div>
<div class="sourceLine" id="cb15-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb15-3" data-line-number="3"></div>
<div class="sourceLine" id="cb15-4" data-line-number="4">  <span class="co">/**</span> Optional arguments to the compilation process<span class="co">. */</span></div>
<div class="sourceLine" id="cb15-5" data-line-number="5">  <span class="kw">def</span> arguments: List[Json]</div>
<div class="sourceLine" id="cb15-6" data-line-number="6">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>CompileReport</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb16"><code class="sourceCode scala"><div class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">trait</span> CompileReport {</div>
<div class="sourceLine" id="cb16-2" data-line-number="2">  <span class="kw">def</span> items: List[CompileReportItem]</div>
<div class="sourceLine" id="cb16-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">trait</span> CompileReportItem {</div>
<div class="sourceLine" id="cb16-5" data-line-number="5"></div>
<div class="sourceLine" id="cb16-6" data-line-number="6">  <span class="co">/**</span> The total number of reported errors compiling this target<span class="co">. */</span></div>
<div class="sourceLine" id="cb16-7" data-line-number="7">  <span class="kw">def</span> errors: Long</div>
<div class="sourceLine" id="cb16-8" data-line-number="8"></div>
<div class="sourceLine" id="cb16-9" data-line-number="9">  <span class="co">/**</span> The total number of reported warnings compiling the target<span class="co">. */</span></div>
<div class="sourceLine" id="cb16-10" data-line-number="10">  <span class="kw">def</span> warnings: Long</div>
<div class="sourceLine" id="cb16-11" data-line-number="11"></div>
<div class="sourceLine" id="cb16-12" data-line-number="12">  <span class="co">/**</span> The total number of milliseconds it took to compile the target<span class="co">. */</span></div>
<div class="sourceLine" id="cb16-13" data-line-number="13">  <span class="kw">def</span> time: Option[Long]</div>
<div class="sourceLine" id="cb16-14" data-line-number="14"></div>
<div class="sourceLine" id="cb16-15" data-line-number="15">  <span class="co">/**</span> The total number of lines of code in the given target<span class="co">. */</span></div>
<div class="sourceLine" id="cb16-16" data-line-number="16">  <span class="kw">def</span> linesOfCode: Option[Long]</div>
<div class="sourceLine" id="cb16-17" data-line-number="17"></div>
<div class="sourceLine" id="cb16-18" data-line-number="18">}</div></code></pre>
<p>The server is free to send any number of <code>textDocument/publishDiagnostics</code> and <code>window/logMessage</code> notifications during compilation before completing the response. The client is free to forward these messages to the LSP editor client.</p>
<h3 id="138-test-request">1.3.8. Test Request</h3>
<p>The test build target request is sent from the client to the server to test the given list of build targets. The server communicates during the initialize handshake whether this method is supported or not.</p>
<ul>
<li>method: <code>buildTarget/Test</code></li>
<li>params: <code>TestParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb17"><code class="sourceCode scala"><div class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">trait</span> TestParams {</div>
<div class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb17-3" data-line-number="3">  <span class="co">/**</span> Optional arguments to the test execution<span class="co">. */</span></div>
<div class="sourceLine" id="cb17-4" data-line-number="4">  <span class="kw">def</span> arguments: List[Json]</div>
<div class="sourceLine" id="cb17-5" data-line-number="5">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>TestReport</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb18"><code class="sourceCode scala"><div class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">trait</span> TestReport {</div>
<div class="sourceLine" id="cb18-2" data-line-number="2">  <span class="kw">def</span> items: List[TestReportItem]</div>
<div class="sourceLine" id="cb18-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw">trait</span> TestReportItem {</div>
<div class="sourceLine" id="cb18-5" data-line-number="5"></div>
<div class="sourceLine" id="cb18-6" data-line-number="6">  <span class="co">/**</span> The compile times before executing tests if the target<span class="co">.</span></div>
<div class="sourceLine" id="cb18-7" data-line-number="7">    <span class="co">*</span> An empty field means the target may have already</div>
<div class="sourceLine" id="cb18-8" data-line-number="8">    <span class="co">*</span> been compiled beforehand<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb18-9" data-line-number="9">  <span class="kw">def</span> compileReport: Option[CompileReportItem]</div>
<div class="sourceLine" id="cb18-10" data-line-number="10"></div>
<div class="sourceLine" id="cb18-11" data-line-number="11">  <span class="co">/**</span> The total number of successful tests<span class="co">. */</span></div>
<div class="sourceLine" id="cb18-12" data-line-number="12">  <span class="kw">def</span> passed: Long</div>
<div class="sourceLine" id="cb18-13" data-line-number="13"></div>
<div class="sourceLine" id="cb18-14" data-line-number="14">  <span class="co">/**</span> The total number of failed tests<span class="co">. */</span></div>
<div class="sourceLine" id="cb18-15" data-line-number="15">  <span class="kw">def</span> failed: Long</div>
<div class="sourceLine" id="cb18-16" data-line-number="16"></div>
<div class="sourceLine" id="cb18-17" data-line-number="17">  <span class="co">/**</span> The total number of milliseconds it took to run the tests<span class="co">.</span></div>
<div class="sourceLine" id="cb18-18" data-line-number="18">    <span class="co">*</span> Should not include compile times<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb18-19" data-line-number="19">  <span class="kw">def</span> time: Option[Long]</div>
<div class="sourceLine" id="cb18-20" data-line-number="20">}</div></code></pre>
<p>The server is free to send any number of <code>textDocument/publishDiagnostics</code> and <code>window/logMessage</code> notifications during compilation before completing the response. The client is free to forward these messages to the LSP editor client.</p>
<h2 id="14-extensions">1.4. Extensions</h2>
<p>The build server protocol is designed to be extended with language specific data structures and methods.</p>
<h3 id="141-scala">1.4.1. Scala</h3>
<p>The following section contains Scala-specific extensions to the build server protocol.</p>
<h4 id="1411-scala-build-target">1.4.1.1. Scala Build Target</h4>
<p><code>ScalaBuildTarget</code> is a basic data structure that contains scala-specific metadata for compiling a target containing Scala sources. This metadata is embedded in the <code>data: Option[Json]</code> field of the <code>BuildTarget</code> definition.</p>
<pre class="sourceCode scala" id="cb19"><code class="sourceCode scala"><div class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">trait</span> ScalaBuildTarget {</div>
<div class="sourceLine" id="cb19-2" data-line-number="2"></div>
<div class="sourceLine" id="cb19-3" data-line-number="3">  <span class="co">/**</span> The Scala organization that is used for a target<span class="co">. */</span></div>
<div class="sourceLine" id="cb19-4" data-line-number="4">  <span class="kw">def</span> scalaOrganization: String</div>
<div class="sourceLine" id="cb19-5" data-line-number="5"></div>
<div class="sourceLine" id="cb19-6" data-line-number="6">  <span class="co">/**</span> The scala version to compile this target <span class="co">*/</span></div>
<div class="sourceLine" id="cb19-7" data-line-number="7">  <span class="kw">def</span> scalaVersion: String</div>
<div class="sourceLine" id="cb19-8" data-line-number="8"></div>
<div class="sourceLine" id="cb19-9" data-line-number="9">  <span class="co">/**</span> The binary version of scalaVersion<span class="co">.</span></div>
<div class="sourceLine" id="cb19-10" data-line-number="10">    <span class="co">*</span> For example<span class="co">,</span> <span class="co">2.12</span> if scalaVersion is <span class="co">2.12.4.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb19-11" data-line-number="11">  <span class="kw">def</span> scalaBinaryVersion: String</div>
<div class="sourceLine" id="cb19-12" data-line-number="12"></div>
<div class="sourceLine" id="cb19-13" data-line-number="13">  <span class="co">/**</span> The target platform for this target <span class="co">*/</span></div>
<div class="sourceLine" id="cb19-14" data-line-number="14">  <span class="kw">def</span> platform: ScalaPlatform</div>
<div class="sourceLine" id="cb19-15" data-line-number="15"></div>
<div class="sourceLine" id="cb19-16" data-line-number="16">}</div>
<div class="sourceLine" id="cb19-17" data-line-number="17"></div>
<div class="sourceLine" id="cb19-18" data-line-number="18"><span class="kw">object</span> ScalaPlatform {</div>
<div class="sourceLine" id="cb19-19" data-line-number="19">  <span class="kw">val</span> JVM = <span class="dv">1</span></div>
<div class="sourceLine" id="cb19-20" data-line-number="20">  <span class="kw">val</span> JS = <span class="dv">2</span></div>
<div class="sourceLine" id="cb19-21" data-line-number="21">  <span class="kw">val</span> Native = <span class="dv">3</span></div>
<div class="sourceLine" id="cb19-22" data-line-number="22">}</div></code></pre>
<h4 id="1412-scalac-options-request">1.4.1.2. Scalac Options Request</h4>
<p>The build target scalac options request is sent from the client to the server to query for the list of compiler options necessary to compile in a given list of targets.</p>
<ul>
<li>method: <code>buildTarget/scalacOptions</code></li>
<li>params: <code>ScalacOptionsParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb20"><code class="sourceCode scala"><div class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">trait</span> ScalacOptionsParams {</div>
<div class="sourceLine" id="cb20-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb20-3" data-line-number="3">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>ScalacOptionsResult</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb21"><code class="sourceCode scala"><div class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">trait</span> ScalacOptionsResult {</div>
<div class="sourceLine" id="cb21-2" data-line-number="2">  <span class="kw">def</span> items: List[ScalcOptionItem]</div>
<div class="sourceLine" id="cb21-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb21-4" data-line-number="4"><span class="kw">trait</span> ScalacOptionsItem {</div>
<div class="sourceLine" id="cb21-5" data-line-number="5">    <span class="kw">def</span> target: BuildTargetIdentifier</div>
<div class="sourceLine" id="cb21-6" data-line-number="6">    <span class="co">/**</span> Additional arguments to the compiler<span class="co">.</span></div>
<div class="sourceLine" id="cb21-7" data-line-number="7">      <span class="co">*</span> For example<span class="co">,</span> <span class="co">-</span>deprecation<span class="co">.</span> <span class="co">*/</span></div>
<div class="sourceLine" id="cb21-8" data-line-number="8">    <span class="kw">def</span> options: List[String]</div>
<div class="sourceLine" id="cb21-9" data-line-number="9">    <span class="co">/**</span> The dependency classpath for this target<span class="co">,</span> must be</div>
<div class="sourceLine" id="cb21-10" data-line-number="10">      <span class="co">*</span> identical to what is passed as arguments to</div>
<div class="sourceLine" id="cb21-11" data-line-number="11">      <span class="co">*</span> the <span class="co">-</span>classpath flag in the command line interface</div>
<div class="sourceLine" id="cb21-12" data-line-number="12">      <span class="co">*</span> of scalac<span class="co">. */</span></div>
<div class="sourceLine" id="cb21-13" data-line-number="13">    <span class="kw">def</span> classpath: List[String]</div>
<div class="sourceLine" id="cb21-14" data-line-number="14">    <span class="co">/**</span> The output directory for classfiles produced by this target <span class="co">*/</span></div>
<div class="sourceLine" id="cb21-15" data-line-number="15">    <span class="kw">def</span> classDirectory: String</div>
<div class="sourceLine" id="cb21-16" data-line-number="16">}</div></code></pre>
<h4 id="1413-scala-test-classes-request">1.4.1.3. Scala Test Classes Request</h4>
<p>The build target scalac options request is sent from the client to the server to query for the list of fully qualified names of test clases in a given list of targets. This method can for example be used by a language server by using <code>textDocument/codeLens</code> to attach a &quot;Run test suite&quot; button above the definition of a test suite. By clicking on the button, the language server can pass the fully qualified name of the test class as an argument to the <code>buildTarget/test</code> request.</p>
<ul>
<li>method: <code>buildTarget/scalaTestClasses</code></li>
<li>params: <code>ScalaTestClassesParams</code></li>
</ul>
<pre class="sourceCode scala" id="cb22"><code class="sourceCode scala"><div class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">trait</span> ScalaTestClassesParams {</div>
<div class="sourceLine" id="cb22-2" data-line-number="2">  <span class="kw">def</span> targets: List[BuildTargetIdentifier]</div>
<div class="sourceLine" id="cb22-3" data-line-number="3">}</div></code></pre>
<p>Response:</p>
<ul>
<li>result: <code>ScalaTestClassesResult</code>, defined as follows</li>
</ul>
<pre class="sourceCode scala" id="cb23"><code class="sourceCode scala"><div class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">trait</span> ScalaTestClassesResult {</div>
<div class="sourceLine" id="cb23-2" data-line-number="2">  <span class="kw">def</span> items: List[ScalaTestClassesItem]</div>
<div class="sourceLine" id="cb23-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw">trait</span> ScalaTestClassesItem {</div>
<div class="sourceLine" id="cb23-5" data-line-number="5">    <span class="kw">def</span> target: BuildTargetIdentifier</div>
<div class="sourceLine" id="cb23-6" data-line-number="6">    <span class="co">/**</span> The fully qualified names of the test classes in this target <span class="co">*/</span></div>
<div class="sourceLine" id="cb23-7" data-line-number="7">    <span class="kw">def</span> classes: List[String]</div>
<div class="sourceLine" id="cb23-8" data-line-number="8">}</div></code></pre>
<h2 id="15-appendix">1.5. Appendix</h2>
<h3 id="151-protobuf-schema-definitions">1.5.1. Protobuf schema definitions</h3>
<p>The data structures presented in this document are accompanied by Protocol Buffers schema definitions. See <a href="src/main/protobuf/bsp.proto">bsp.proto</a>.</p>
<h3 id="152-scala-bindings">1.5.2. Scala Bindings</h3>
<p>A Scala library implementation of this communication protocol is available in this repository. The public API of this library currently has three direct Scala dependencies:</p>
<ul>
<li>ScalaPB - for generation of Scala sources from protobuf schema</li>
<li>Monix - for asynchronous programming primitives</li>
<li>Circe - for JSON serialization and parsing of protocol data structures</li>
</ul>
<p>If there is demand, it should be possible to refactor out all three dependencies to provide a zero dependency core module.</p>
</body>
</html>
